<html>
    <head>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
            
            <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
                integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    </head>
    <body>
        <div id="create-update" style="display:none">
            <h2>create-edit new</h2>
            <table id="createUpdateForm">
                
		<tr>
                    <td>ID</td>
                    <td><input type="text" name="ID" id="idInput"></td>
                </tr>
                <tr>
                    <td>DateAdded</td>
                    <td><input type="text" name="DateAdded"></td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td><input type="text" name="Title"></td>
                </tr>
                <tr>
                    <td>Description</td>
                    <td><input type="text" name="Description"></td>
                </tr>
                <tr>    
                    <td>Category</td>
                    <td><input type="text" name="Category"></td>
                </tr>
                <tr>    
                    <td>Priority</td>
                    <td><input type="text" name="Priority"></td>
                </tr>
                <tr>    
                    <td>Status</td>
                    <td><input type="text" name="Status"></td>
                </tr>
                <tr>    
                    <td>DeadlineDate</td>
                    <td><input type="text" name="DeadlineDate"></td>
                </tr>
                <tr>
                    <td></td><td>
                        <button id="create-button" onclick="doCreate()">Create</button>     
                        <button id="update-button" onclick="doUpdate()">update</button>
                    </td>
                </tr>

            </table>
        </div>
        <div id="display">
            <h2>tasks</h2>
            <button onClick="showCreate()">Create</button>
            <table id="taskTable" class="table">
		
		    <tr>
                    <th>ID</th>
                    <th>DateAdded</th>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Category</th>
                    <th>Priority</th>
                    <th>Status</th>
                    <th>DeadlineDate</th>
                </tr>



                
            </table>

        </div>



        <script>
            function showCreate(){
                document.getElementById('display').style.display = "none"
                document.getElementById('update-button').style.display = "none"
                document.getElementById('create-button').style.display = "block"
                document.getElementById('create-update').style.display = "block"

            }




            function showUpdate(thisElem){
                var rowElement = thisElem.parentNode.parentNode;
                task = readtaskFromRow(rowElement)
                populateForm(task)

                document.getElementById('display').style.display = "none"
                document.getElementById('update-button').style.display = "block"
                document.getElementById('create-button').style.display = "none"
                document.getElementById('create-update').style.display = "block"

            }
            function readtaskFromRow(rowElement){
                task = {}
                task.ID = rowElement.getAttribute("ID");
                task.DateAdded = rowElement.cells[1].firstChild.textContent
		        task.Title = rowElement.cells[2].firstChild.textContent
                task.Description = rowElement.cells[3].firstChild.textContent
                task.Category = rowElement.cells[4].firstChild.textContent
		        task.Priority = rowElement.cells[5].firstChild.textContent
                task.Status = rowElement.cells[6].firstChild.textContent
                task.DeadlineDate = rowElement.cells[7].firstChild.textContent

                return task
                
            }
            function populateForm(task){
                var form = document.getElementById('createUpdateForm')

                
                form.querySelector('input[name="ID"]').value = task.ID
                form.querySelector('input[name="ID"]').disabled=true
                form.querySelector('input[name="Title"]').value = task.Title
        	    form.querySelector('input[name="Description"]').value= task.Description
        	    form.querySelector('input[name="Category"]').value= task.Category
        	    form.querySelector('input[name="Priority"]').value= task.Priority
        	    form.querySelector('input[name="Status"]').value= task.Status
        	    form.querySelector('input[name="DeadlineDate"]').value= task.DeadlineDate



    
            }
            function clearForm() {
                    var form = document.getElementById('createUpdateForm')

		    form.querySelector('input[name="Title"]').value=''
        	form.querySelector('input[name="Description"]').value=''
        	form.querySelector('input[name="Category"]').value=''
        	form.querySelector('input[name="Priority"]').value=''
        	form.querySelector('input[name="Status"]').value=''
        	form.querySelector('input[name="DeadlineDate"]').value=''




                }

            function doCreate(){
                console.log("in doCreate")
                task= gettaskFromForm()
                console.log(task)
                $.ajax({
                    url:"http://127.0.0.1:5000/task",
                    data:JSON.stringify(task),
                    method:"POST",
                    dataType:"JSON",
                    contentType: "application/json; charset=utf-8",
                    success:function(result){
                        console.log(result) 
                        addtaskToTable(task)
                        showDisplay()
                        clearForm()

                    },
                    error:function(xhr,status,error){
                        console.log("error"+error)
                    }
                })
               
            }
            function doUpdate(){
                task = gettaskFromForm()
                updateServer(task)
                
            }
            function updateServer(task){
               $.ajax({
                    url: "http://127.0.0.1:5000/task"+task.ID,
                    data: JSON.stringify(task),
                    method: "PUT",
                    dataType: "JSON",
                    contentType: "application/json; charset=utf-8",
                    success: function (result) {
                        console.log(result)
                        updateTableRow(task)
                        showDisplay()
                        clearForm()

                    },
                    error: function (xhr, status, error) {
                        console.log("error" + error)
                    }
                })
            }
            function doDelete(thisElem){
                var tableElement = document.getElementById('taskTable');
                var rowElement = thisElem.parentNode.parentNode;
                var index = rowElement.rowIndex;
                ID = rowElement.getAttribute("id");
                $.ajax({
                    url:"http://127.0.0.1:5000/task"+ID,
                    method:"DELETE",
                    dateType:"JSON",
                    success:function(result){
                        tableElement.deleteRow(index);
                    },
                    error:function(xhr,status,error){
                        console.log(error)
                    }
                })
                
            }



            function updateTableRow(task){
                rowElement = document.getElementById(task.ID)
		        rowElement.cells[1].firstChild.textContent= task.Title
        	    rowElement.cells[2].firstChild.textContent= task.Description
        	    rowElement.cells[3].firstChild.textContent= task.Category
        	    rowElement.cells[4].firstChild.textContent= task.Priority
        	    rowElement.cells[5].firstChild.textContent= task.Status
        	    rowElement.cells[6].firstChild.textContent = task.DeadlineDate
                
		//console.log("updating table")
            }






            function gettaskFromForm(){
                var form = document.getElementById('createUpdateForm')
                var task = {}


		//task.ID =form.querySelector('input[name="ID"]').value
        	task.Title = form.querySelector('input[name="Title"]').value
        	task.Description = form.querySelector('input[name="Description"]').value
        	task.Category = form.querySelector('input[name="Category"]').value
        	task.Priority = form.querySelector('input[name="Priority"]').value
        	task.Status = form.querySelector('input[name="Status"]').value
        	task.DeadlineDate = form.querySelector('input[name="DeadlineDate"]').value
                


		//console.log(task)
                 return task
            }
             function showDisplay() {
                    document.getElementById('display').style.display = "block"
                    document.getElementById('create-update').style.display = "none"

                }

            function populateTable(){
                //ajax getAll
               $.ajax({
                   url:'http://127.0.0.1:5000/task',
                   method:'GET',
                   datatype:'JSON',
                   success:function(results){
                        for (task of results){
                             addtaskToTable(task)
                        }
                   },
                   error:function (xhr,status,error){
                       console.log ("error "+error +" code:"+status)
                   }

               })
               
            }
            function addtaskToTable(task){
        	var tableElement = document.getElementById('taskTable')
        	var rowElement = tableElement.insertRow(-1)
        	rowElement.setAttribute('ID',task.ID)
        	var cell1 = rowElement.insertCell(0);
        	cell1.innerHTML = task.ID
        	var cell2 = rowElement.insertCell(1);
        	cell2.innerHTML = task.DateAdded
        	var cell3 = rowElement.insertCell(2);
        	cell3.innerHTML = task.Title
        	var cell4 = rowElement.insertCell(3);
        	cell4.innerHTML = task.Description
        	var cell5 = rowElement.insertCell(4);
        	cell5.innerHTML = task.Category
        	var cell6 = rowElement.insertCell(5);
        	cell6.innerHTML = task.Priority
        	var cell7 = rowElement.insertCell(6);
        	cell7.innerHTML = task.Status
        	var cell8 = rowElement.insertCell(7);
        	cell8.innerHTML = task.DeadlineDate
        	var cell9 = rowElement.insertCell(8);
        	cell9.innerHTML = '<button onclick="showUpdate(this)">Update</button>'
        	var cell10 = rowElement.insertCell(9);
        	cell10.innerHTML = '<button onclick=doDelete(this)>delete</button>'






                 }
            populateTable()
        </script>
    </body>
</html>